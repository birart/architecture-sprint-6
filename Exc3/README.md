# Описание проблем и решений

1. Сервис ins-comp-settlement делает раз в сутки запрос в core-app для получения оформленных страховок. Это создает дополнительную нагрузку на core-app. Также за один день может быть оформлено большое количество страховок и будет не совсем оптимально запрашивать большой объем данных в рамках одного долгого запроса.

**Решение**: Чтобы избавиться от связности сервисов через синхронный запрос мы можем переделать взаимодействие на асинхронное с помощью событий. Таким образом core-app будет публиковать событие об оформлении новой страховки в очередь сообщений, а ins-comp-settlement будет подписан на эти события. При этом придется реализовать паттерн Transactional Outbox на стороне core-app, чтобы гарантированно изменять состояние сущности "страховка" и отправлять событие об этом.


2. При синхронном запросе core-app в ins-product-aggregator мы ожидаем ответа от всех API страховых компаний, при этом какие-то API могут быть недоступны в данный момент или может произойти ошибка запроса и ответ не будет получен. Также критичным фактором для скорости является время ответа. Время ответа от API ins-product-aggregator будет определяться временем самого медленного API. 

**Решение**: Во-первых в задании не сказано о том, что страховые сервисы опрашиваются асинхронно. Можем реализовать одновременный опрос для каждого API. Если API одного из страховых сервисов недоступно - на этот случай реализуем паттерн Circuit Breaker, чтобы не стучаться в недоступное API в течение некоторого периода. Также установим таймауты на запросы.

3. Сервисы core-app и ins-comp-settlement хранят собственные реплики данных о продуктах и вынуждены обновлять их через синхронный запрос к аггрегатору.

**Решение**: Вместо этого, обновление данных можно переделать на асинхронные события. ins-product-aggregator может сам через определенный интервал (менее 15 минут, если это не нарушает лимиты на запросы внешних API) опрашивать внешние страховые сервисы и публиковать событие как только получит новые данные по одной из систем. Если данные не были получены, то об этом тоже публикуется событие. На основании этих событий сервисы core-app и ins-comp-settlement могут актуализировать свои реплики данных будучи подписаны на нужные топики.
 Не до конца понятно для чего нужен запрос из ins-comp-settlement в ins-product-aggregator, если нужны самые актуальные данные то API аггрегатора можно оставить действующим.

4. Так как все взаимодействия back-to-back становятся асинхронными, то получать данные по REST в Web приложение становится не очень эффективно.  

**Решение**: Можем использовать Websocket и технологию Server push, чтобы отображать клиенту данные по мере их поступления от страховых компаний.